import{r as e,z as a,i as t,y as l,c as r,a as s,b as o,j as n,k as i,l as d,w as c,p as u,A as p,u as m,F as v,e as g,h as y,d as f,g as b,m as h,t as w,f as k,n as D}from"./vendor-vue.GR9O-o6O.js";import{u as A,_ as T}from"./index.BFYIaKWM.js";const P={class:"orders-list"},C={class:"d-flex justify-content-between align-items-center mb-4"},R={class:"card mb-4"},L={class:"card-body"},N={class:"row g-3"},S={class:"col-md-3"},O={class:"col-md-2"},V=["value"],x={class:"col-md-2"},I={class:"col-md-2"},E={class:"col-md-3"},B=["value"],M={class:"row mt-3"},Y={class:"col-md-4"},_={class:"input-group"},K={class:"col-md-8 d-flex justify-content-end"},Q={class:"card"},H={class:"card-body"},j={key:0,class:"text-center py-4"},q={key:1,class:"text-center py-4"},z={key:2},U={class:"table-responsive"},F={class:"table table-hover"},G={key:0},J={key:1},Z={class:"progress"},$=["aria-valuenow"],W=["onClick"],X={key:0,class:"d-flex justify-content-center mt-3"},ee={class:"pagination"},ae=["onClick"],te={key:0,class:"modal fade show",style:{display:"block"}},le={class:"modal-dialog"},re={class:"modal-content"},se={class:"modal-header"},oe={class:"modal-body"},ne={class:"modal-footer"},ie=["disabled"],de={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},ce=T({__name:"OrderList",setup(T){const{isLoading:ce,filters:ue,sorting:pe,pagination:me,paginatedOrders:ve,customerList:ge,cellTypeList:ye,loadOrders:fe,nextPage:be,prevPage:he,goToPage:we,sortBy:ke,clearFilters:De,getStatusText:Ae,getStatusBadgeClass:Te}=function(){const{showToast:r}=A(),s=e([]),o=e(!1),n=e(0),i=a({searchQuery:"",cellType:"",status:"",dateRange:{start:"",end:""},priorityLevel:"",customerName:""}),d=a({field:"orderDate",direction:"desc"}),c=a({currentPage:1,itemsPerPage:10,totalPages:t((()=>Math.ceil(u.value.length/c.itemsPerPage)))}),u=t((()=>{let e=[...s.value];if(i.searchQuery){const a=i.searchQuery.toLowerCase();e=e.filter((e=>{var t,l,r;return(null==(t=e.orderNo)?void 0:t.toLowerCase().includes(a))||(null==(r=null==(l=e.customerInfo)?void 0:l.name)?void 0:r.toLowerCase().includes(a))}))}return i.cellType&&(e=e.filter((e=>!(!e.cells||!e.cells.length)&&e.cells.some((e=>{var a;return null==(a=e.productTypeCode)?void 0:a.includes(i.cellType)}))))),i.status&&(e=e.filter((e=>e.status===i.status))),(i.dateRange.start||i.dateRange.end)&&(e=e.filter((e=>{const a=new Date(e.orderDate);if(i.dateRange.start&&i.dateRange.end){const e=new Date(i.dateRange.start),t=new Date(i.dateRange.end);return a>=e&&a<=t}return i.dateRange.start?a>=new Date(i.dateRange.start):!i.dateRange.end||a<=new Date(i.dateRange.end)}))),i.priorityLevel&&(e=e.filter((e=>e.priority===i.priorityLevel))),i.customerName&&(e=e.filter((e=>{var a,t;return null==(t=null==(a=e.customerInfo)?void 0:a.name)?void 0:t.toLowerCase().includes(i.customerName.toLowerCase())}))),e.sort(((e,a)=>{let t=g(e,d.field),l=g(a,d.field);return"orderDate"!==d.field&&"createdAt"!==d.field&&"updatedAt"!==d.field||(t=t?new Date(t).getTime():0,l=l?new Date(l).getTime():0),"asc"===d.direction?t>l?1:t<l?-1:0:t<l?1:t>l?-1:0})),e})),p=t((()=>{const e=(c.currentPage-1)*c.itemsPerPage,a=e+c.itemsPerPage;return u.value.slice(e,a)})),m=t((()=>{const e=new Set;return s.value.forEach((a=>{var t;(null==(t=a.customerInfo)?void 0:t.name)&&e.add(a.customerInfo.name)})),Array.from(e).sort()})),v=t((()=>{const e=new Set;return s.value.forEach((a=>{a.cells&&a.cells.length&&a.cells.forEach((a=>{a.productTypeCode&&e.add(a.productTypeCode)}))})),Array.from(e).sort()}));function g(e,a){return a.split(".").reduce(((e,a)=>e&&void 0!==e[a]?e[a]:null),e)}function y(){return[{id:"order-001",orderNo:"#0424-1251",orderDate:"2024-04-01",customerInfo:{name:"AYEDAŞ",documentNo:"PO-2024-A156",contactPerson:"Ahmet Yılmaz"},cells:[{productTypeCode:"RM 36 CB",technicalValues:"36kV 630A 16kA Kesicili ÇIKIŞ Hücresi",quantity:1,deliveryDate:"2024-11-15"}],status:"delayed",progress:65,priority:"high",createdAt:new Date("2024-04-01"),updatedAt:new Date("2024-04-15")},{id:"order-002",orderNo:"#0424-1245",orderDate:"2024-04-05",customerInfo:{name:"BEDAŞ",documentNo:"PO-2024-B789",contactPerson:"Mehmet Demir"},cells:[{productTypeCode:"RM 36 LB",technicalValues:"36kV 630A 16kA Yük Ayırıcılı Giriş Hücresi",quantity:2,deliveryDate:"2024-11-20"},{productTypeCode:"RM 36 CB",technicalValues:"36kV 630A 16kA Kesicili ÇIKIŞ Hücresi",quantity:3,deliveryDate:"2024-11-20"}],status:"in_progress",progress:35,priority:"medium",createdAt:new Date("2024-04-05"),updatedAt:new Date("2024-04-10")},{id:"order-003",orderNo:"#0424-1239",orderDate:"2024-04-08",customerInfo:{name:"TOROSLAR EDAŞ",documentNo:"PO-2024-T321",contactPerson:"Zeynep Kaya"},cells:[{productTypeCode:"RM 36 FL",technicalValues:"36kV 200A 16kA Sigortalı Yük Ayırıcılı TR.Koruma Hücresi",quantity:2,deliveryDate:"2024-12-05"}],status:"planned",progress:10,priority:"low",createdAt:new Date("2024-04-08"),updatedAt:new Date("2024-04-08")},{id:"order-004",orderNo:"#0424-1233",orderDate:"2024-03-25",customerInfo:{name:"ENERJİSA",documentNo:"PO-2024-E456",contactPerson:"Can Demir"},cells:[{productTypeCode:"RM 36 LB",technicalValues:"36kV 630A 16kA Yük Ayırıcılı Giriş Hücresi",quantity:1,deliveryDate:"2024-12-05"}],status:"completed",progress:100,priority:"medium",createdAt:new Date("2024-03-25"),updatedAt:new Date("2024-04-17")},{id:"order-005",orderNo:"#0424-1220",orderDate:"2024-03-15",customerInfo:{name:"OSMANİYE ELEKTRİK",documentNo:"PO-2024-O789",contactPerson:"Ali Yıldız"},cells:[{productTypeCode:"RM 36 FL",technicalValues:"36kV 200A 16kA Sigortalı Yük Ayırıcılı TR.Koruma Hücresi",quantity:1,deliveryDate:"2024-10-30"}],status:"planned",progress:5,priority:"low",createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-15")}]}return l([()=>i.searchQuery,()=>i.cellType,()=>i.status,()=>i.dateRange.start,()=>i.dateRange.end,()=>i.priorityLevel,()=>i.customerName],(()=>{c.currentPage=1})),{orders:s,isLoading:o,totalOrderCount:n,filters:i,sorting:d,pagination:c,filteredOrders:u,paginatedOrders:p,customerList:m,cellTypeList:v,loadOrders:async function(){try{if(o.value=!0,window.firebase&&window.firebase.firestore){const e=await window.firebase.firestore().collection("orders").orderBy("createdAt","desc").get(),a=[];return e.forEach((e=>{var t,l;const r=e.data();a.push({id:e.id,...r,createdAt:(null==(t=r.createdAt)?void 0:t.toDate())||new Date,updatedAt:(null==(l=r.updatedAt)?void 0:l.toDate())||new Date})})),s.value=a,n.value=a.length,a}{const e=y();return s.value=e,n.value=e.length,e}}catch(e){r("Siparişler yüklenemedi: "+e.message,"error");const a=y();return s.value=a,n.value=a.length,a}finally{o.value=!1}},nextPage:function(){c.currentPage<c.totalPages&&c.currentPage++},prevPage:function(){c.currentPage>1&&c.currentPage--},goToPage:function(e){e>=1&&e<=c.totalPages&&(c.currentPage=e)},sortBy:function(e){d.field===e?d.direction="asc"===d.direction?"desc":"asc":(d.field=e,d.direction="desc")},clearFilters:function(){Object.assign(i,{searchQuery:"",cellType:"",status:"",dateRange:{start:"",end:""},priorityLevel:"",customerName:""})},getStatusText:function(e){return{planned:"Planlandı",in_progress:"Devam Ediyor",delayed:"Gecikiyor",completed:"Tamamlandı",canceled:"İptal Edildi"}[e]||e},getStatusBadgeClass:function(e){return{planned:"status-badge status-planned",in_progress:"status-badge status-progress",delayed:"status-badge status-delayed",completed:"status-badge status-completed",canceled:"status-badge status-canceled"}[e]||""}}}(),Pe=e(!1),Ce=e(null),Re=e(!1);async function Le(){if(Ce.value)try{Re.value=!0,window.firebase&&window.firebase.firestore&&await window.firebase.firestore().collection("orders").doc(Ce.value.id).delete(),await fe(),Pe.value=!1,Ce.value=null}catch(e){alert("Sipariş silinemedi: "+e.message)}finally{Re.value=!1}}return fe(),(e,a)=>{var t;const l=d("router-link");return k(),r("div",P,[s("div",C,[a[16]||(a[16]=s("h1",null,"Siparişler",-1)),n(l,{to:{name:"OrderCreate"},class:"btn btn-primary"},{default:i((()=>a[15]||(a[15]=[s("i",{class:"bi bi-plus-circle me-2"},null,-1),f(" Yeni Sipariş ")]))),_:1})]),s("div",R,[s("div",L,[s("div",N,[s("div",S,[a[17]||(a[17]=s("label",{for:"searchQuery",class:"form-label"},"Arama",-1)),c(s("input",{type:"text",id:"searchQuery","onUpdate:modelValue":a[0]||(a[0]=e=>p(ue).searchQuery=e),class:"form-control",placeholder:"Sipariş No, Müşteri..."},null,512),[[u,p(ue).searchQuery]])]),s("div",O,[a[19]||(a[19]=s("label",{for:"cellType",class:"form-label"},"Hücre Tipi",-1)),c(s("select",{id:"cellType","onUpdate:modelValue":a[1]||(a[1]=e=>p(ue).cellType=e),class:"form-select"},[a[18]||(a[18]=s("option",{value:""},"Tümü",-1)),(k(!0),r(v,null,g(p(ye),(e=>(k(),r("option",{key:e,value:e},w(e),9,V)))),128))],512),[[m,p(ue).cellType]])]),s("div",x,[a[21]||(a[21]=s("label",{for:"status",class:"form-label"},"Durum",-1)),c(s("select",{id:"status","onUpdate:modelValue":a[2]||(a[2]=e=>p(ue).status=e),class:"form-select"},a[20]||(a[20]=[y('<option value="" data-v-f0230e12>Tümü</option><option value="planned" data-v-f0230e12>Planlandı</option><option value="in_progress" data-v-f0230e12>Üretimde</option><option value="delayed" data-v-f0230e12>Gecikmiş</option><option value="completed" data-v-f0230e12>Tamamlandı</option>',5)]),512),[[m,p(ue).status]])]),s("div",I,[a[23]||(a[23]=s("label",{for:"priorityLevel",class:"form-label"},"Öncelik",-1)),c(s("select",{id:"priorityLevel","onUpdate:modelValue":a[3]||(a[3]=e=>p(ue).priorityLevel=e),class:"form-select"},a[22]||(a[22]=[s("option",{value:""},"Tümü",-1),s("option",{value:"high"},"Yüksek",-1),s("option",{value:"medium"},"Orta",-1),s("option",{value:"low"},"Düşük",-1)]),512),[[m,p(ue).priorityLevel]])]),s("div",E,[a[25]||(a[25]=s("label",{for:"customerName",class:"form-label"},"Müşteri",-1)),c(s("select",{id:"customerName","onUpdate:modelValue":a[4]||(a[4]=e=>p(ue).customerName=e),class:"form-select"},[a[24]||(a[24]=s("option",{value:""},"Tümü",-1)),(k(!0),r(v,null,g(p(ge),(e=>(k(),r("option",{key:e,value:e},w(e),9,B)))),128))],512),[[m,p(ue).customerName]])])]),s("div",M,[s("div",Y,[s("div",_,[a[26]||(a[26]=s("span",{class:"input-group-text"},"Tarih",-1)),c(s("input",{type:"date","onUpdate:modelValue":a[5]||(a[5]=e=>p(ue).dateRange.start=e),class:"form-control",placeholder:"Başlangıç"},null,512),[[u,p(ue).dateRange.start]]),c(s("input",{type:"date","onUpdate:modelValue":a[6]||(a[6]=e=>p(ue).dateRange.end=e),class:"form-control",placeholder:"Bitiş"},null,512),[[u,p(ue).dateRange.end]])])]),s("div",K,[s("button",{onClick:a[7]||(a[7]=(...e)=>p(De)&&p(De)(...e)),class:"btn btn-outline-secondary"},a[27]||(a[27]=[s("i",{class:"bi bi-x-circle me-1"},null,-1),f(" Filtreleri Temizle ")]))])])])]),s("div",Q,[s("div",H,[p(ce)?(k(),r("div",j,a[28]||(a[28]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Yükleniyor...")],-1)]))):0===p(ve).length?(k(),r("div",q,a[29]||(a[29]=[s("p",{class:"mb-0"},"Sipariş bulunamadı.",-1)]))):(k(),r("div",z,[s("div",U,[s("table",F,[s("thead",null,[s("tr",null,[s("th",{onClick:a[8]||(a[8]=e=>p(ke)("orderNo")),class:"cursor-pointer"},[a[30]||(a[30]=f(" Sipariş No ")),"orderNo"===p(pe).field?(k(),r("i",{key:0,class:b("asc"===p(pe).direction?"bi bi-arrow-up":"bi bi-arrow-down")},null,2)):o("",!0)]),s("th",{onClick:a[9]||(a[9]=e=>p(ke)("customerInfo.name")),class:"cursor-pointer"},[a[31]||(a[31]=f(" Müşteri ")),"customerInfo.name"===p(pe).field?(k(),r("i",{key:0,class:b("asc"===p(pe).direction?"bi bi-arrow-up":"bi bi-arrow-down")},null,2)):o("",!0)]),a[33]||(a[33]=s("th",null,"Hücreler",-1)),s("th",{onClick:a[10]||(a[10]=e=>p(ke)("orderDate")),class:"cursor-pointer"},[a[32]||(a[32]=f(" Sipariş Tarihi ")),"orderDate"===p(pe).field?(k(),r("i",{key:0,class:b("asc"===p(pe).direction?"bi bi-arrow-up":"bi bi-arrow-down")},null,2)):o("",!0)]),a[34]||(a[34]=s("th",null,"Durum",-1)),a[35]||(a[35]=s("th",null,"İlerleme",-1)),a[36]||(a[36]=s("th",null,"İşlemler",-1))])]),s("tbody",null,[(k(!0),r(v,null,g(p(ve),(e=>{var t,o;return k(),r("tr",{key:e.id},[s("td",null,w(e.orderNo),1),s("td",null,w(null==(t=e.customerInfo)?void 0:t.name),1),s("td",null,[e.cells&&e.cells.length?(k(),r("div",G,[(k(!0),r(v,null,g(e.cells,((e,a)=>(k(),r("div",{key:a,class:"mb-1"},w(e.productTypeCode)+" ("+w(e.quantity)+" adet) ",1)))),128))])):(k(),r("span",J,"-"))]),s("td",null,w(new Date(e.orderDate).toLocaleDateString("tr-TR")),1),s("td",null,[s("span",{class:b("badge "+p(Te)(e.status))},w(p(Ae)(e.status)),3)]),s("td",null,[s("div",Z,[s("div",{class:b(["progress-bar",(o=e.progress,o>=100?"bg-success":o>=75?"bg-info":o>=50?"bg-primary":o>=25?"bg-warning":"bg-danger")]),role:"progressbar",style:D(`width: ${e.progress}%`),"aria-valuenow":e.progress,"aria-valuemin":"0","aria-valuemax":"100"},w(e.progress)+"% ",15,$)])]),s("td",null,[n(l,{to:{name:"OrderDetail",params:{id:e.id}},class:"btn btn-sm btn-outline-primary me-1"},{default:i((()=>a[37]||(a[37]=[s("i",{class:"bi bi-eye"},null,-1)]))),_:2},1032,["to"]),s("button",{onClick:a=>function(e){Ce.value=e,Pe.value=!0}(e),class:"btn btn-sm btn-outline-danger"},a[38]||(a[38]=[s("i",{class:"bi bi-trash"},null,-1)]),8,W)])])})),128))])])]),p(me).totalPages>1?(k(),r("div",X,[s("nav",null,[s("ul",ee,[s("li",{class:b(["page-item",{disabled:1===p(me).currentPage}])},[s("a",{class:"page-link",href:"#",onClick:a[11]||(a[11]=h(((...e)=>p(he)&&p(he)(...e)),["prevent"]))},"Önceki")],2),(k(!0),r(v,null,g(p(me).totalPages,(e=>(k(),r("li",{key:e,class:b(["page-item",{active:e===p(me).currentPage}])},[s("a",{class:"page-link",href:"#",onClick:h((a=>p(we)(e)),["prevent"])},w(e),9,ae)],2)))),128)),s("li",{class:b(["page-item",{disabled:p(me).currentPage===p(me).totalPages}])},[s("a",{class:"page-link",href:"#",onClick:a[12]||(a[12]=h(((...e)=>p(be)&&p(be)(...e)),["prevent"]))},"Sonraki")],2)])])])):o("",!0)]))])]),Pe.value?(k(),r("div",te,[s("div",le,[s("div",re,[s("div",se,[a[39]||(a[39]=s("h5",{class:"modal-title"},"Sipariş Silme",-1)),s("button",{type:"button",class:"btn-close",onClick:a[13]||(a[13]=e=>Pe.value=!1)})]),s("div",oe,[s("p",null,[s("strong",null,w(null==(t=Ce.value)?void 0:t.orderNo),1),a[40]||(a[40]=f(" numaralı siparişi silmek istediğinizden emin misiniz? "))]),a[41]||(a[41]=s("p",{class:"text-danger"},"Bu işlem geri alınamaz!",-1))]),s("div",ne,[s("button",{type:"button",class:"btn btn-secondary",onClick:a[14]||(a[14]=e=>Pe.value=!1)},"İptal"),s("button",{type:"button",class:"btn btn-danger",onClick:Le,disabled:Re.value},[Re.value?(k(),r("span",de)):o("",!0),a[42]||(a[42]=f(" Siparişi Sil "))],8,ie)])])]),a[43]||(a[43]=s("div",{class:"modal-backdrop fade show"},null,-1))])):o("",!0)])}}},[["__scopeId","data-v-f0230e12"]]);export{ce as default};
